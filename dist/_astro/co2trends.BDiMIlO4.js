import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BVOCwoKb.js";import{P as E}from"./react-plotly.BKWezMxa.js";import{c as $}from"./transform.BbU07-m7.js";import{t as p}from"./defaultLocale.BPyJQ740.js";function R(){const[l,f]=o.useState("daily"),[s,v]=o.useState("0"),[b,h]=o.useState([]),[y,u]=o.useState(null),[x,m]=o.useState(null),[w,g]=o.useState(!0),j=["0","25","26","27","28","29","30"],k=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}],d=(e,i)=>{const c=new Date(e);switch(i){case"daily":return p("%b %d")(c);case"weekly":return p("%b %d")(c);case"monthly":return p("%B")(c);default:return e}};return o.useEffect(()=>{(async()=>{g(!0),m(null);try{const i=`co2trends_floor${s}.csv`,c=`/data/air%20quality/trends/${l}/${i}`,r=await $(c);if(!r||r.length===0)throw new Error("No data available for the selected parameters");let n;l==="daily"?n=r.map(a=>d(a.date,"daily")):l==="weekly"?n=r.map(a=>d(a.week_start,"weekly")):n=r.map(a=>d(a.month,"monthly"));const D=r.map(a=>+a.excellent),A=r.map(a=>+a.fair),C=r.map(a=>+a.needs_improvement),N=[{x:n,y:D,name:"Excellent (<= 600ppm)",type:"bar",marker:{color:"#5ABA8A"},hovertemplate:'<b style="color: #5ABA8A">%{x}</b><br><span style="color: #5ABA8A">Excellent: %{y:.1f}%</span><br><span style="color: #5ABA8A">CO₂ ≤ 600 ppm</span><br><extra></extra>'},{x:n,y:A,name:"Fair (600-1000ppm)",type:"bar",marker:{color:"#FCD566"},hovertemplate:'<b style="color: #FCD566">%{x}</b><br><span style="color: #FCD566">Fair: %{y:.1f}%</span><br><span style="color: #FCD566">CO₂: 600-1000 ppm</span><br><extra></extra>'},{x:n,y:C,name:"Needs Improvement (> 1000ppm)",type:"bar",marker:{color:"#E77D73"},hovertemplate:'<b style="color: #E77D73">%{x}</b><br><span style="color: #E77D73">Needs Improvement: %{y:.1f}%</span><br><span style="color: #E77D73">CO₂ > 1000 ppm</span><br><extra></extra>'}],F={barmode:"stack",title:{text:`${l.charAt(0).toUpperCase()+l.slice(1)} Air Quality Breakdown (CO₂)${s!=="all"?` - ${s==="0"?"Lobby":`Floor ${s}`}`:""}`,x:.5},hovermode:"closest",hoverlabel:{bgcolor:"white",bordercolor:"lightgray",font:{size:14},align:"left"},xaxis:{title:l.charAt(0).toUpperCase()+l.slice(1),tickangle:0,tickfont:{size:12}},yaxis:{title:"Percent Time",range:[0,100]},legend:{orientation:"v",x:1.05,y:1},margin:{r:120},height:750,width:1356,plot_bgcolor:"white",paper_bgcolor:"white"};h(N),u(F),m(null)}catch(i){m(i.message),h([]),u(null)}finally{g(!1)}})()},[l,s]),t.jsxs("div",{children:[t.jsxs("div",{className:"filter-controls flex gap-4 mb-4",children:[t.jsxs("div",{className:"filter-group",children:[t.jsx("label",{htmlFor:"time-range-select",className:"block text-sm font-medium mb-1",children:"Time Range"}),t.jsx("select",{id:"time-range-select",value:l,onChange:e=>f(e.target.value),className:"block w-40 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none",children:k.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"filter-group",children:[t.jsx("label",{htmlFor:"floor-select",className:"block text-sm font-medium mb-1",children:"Floor"}),t.jsx("select",{id:"floor-select",value:s,onChange:e=>v(e.target.value),className:"block w-40 px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none",children:j.map(e=>t.jsx("option",{value:e,children:e==="0"?"Lobby":`Floor ${e}`},e))})]})]}),t.jsx("div",{style:{minHeight:750,position:"relative"},children:w?t.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"white",zIndex:2},children:t.jsx("div",{className:"text-gray-600",children:"Loading chart data..."})}):x?t.jsxs("div",{className:"text-red-600 mb-4 p-4 bg-red-50 rounded",children:["Error loading data: ",x]}):b.length>0&&y?t.jsx(E,{data:b,layout:y,config:{responsive:!0}}):t.jsx("div",{className:"text-gray-600 p-4 text-center",children:"No data available for the selected parameters"})})]})}export{R as default};
